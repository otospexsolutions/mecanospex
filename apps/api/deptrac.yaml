# Deptrac Configuration for AutoERP Module Boundaries
# Run: ./vendor/bin/deptrac analyse --config-file=deptrac.yaml

deptrac:
  paths:
    - ./app

  exclude_files:
    - '#.*test.*#i'

  layers:
    # Shared layers (accessible by all modules)
    - name: SharedDomain
      collectors:
        - type: directory
          value: app/Shared/Domain/.*

    - name: SharedContracts
      collectors:
        - type: directory
          value: app/Shared/Contracts/.*

    - name: SharedApplication
      collectors:
        - type: directory
          value: app/Shared/Application/.*

    - name: SharedInfrastructure
      collectors:
        - type: directory
          value: app/Shared/Infrastructure/.*

    # Module Domain Layers (core business logic, no external dependencies)
    - name: IdentityDomain
      collectors:
        - type: directory
          value: app/Modules/Identity/Domain/.*

    - name: TenantDomain
      collectors:
        - type: directory
          value: app/Modules/Tenant/Domain/.*

    - name: CatalogDomain
      collectors:
        - type: directory
          value: app/Modules/Catalog/Domain/.*

    - name: VehicleDomain
      collectors:
        - type: directory
          value: app/Modules/Vehicle/Domain/.*

    - name: PartnerDomain
      collectors:
        - type: directory
          value: app/Modules/Partner/Domain/.*

    - name: WorkshopDomain
      collectors:
        - type: directory
          value: app/Modules/Workshop/Domain/.*

    - name: SalesDomain
      collectors:
        - type: directory
          value: app/Modules/Sales/Domain/.*

    - name: InventoryDomain
      collectors:
        - type: directory
          value: app/Modules/Inventory/Domain/.*

    - name: TreasuryDomain
      collectors:
        - type: directory
          value: app/Modules/Treasury/Domain/.*

    - name: AccountingDomain
      collectors:
        - type: directory
          value: app/Modules/Accounting/Domain/.*

    - name: CommunicationDomain
      collectors:
        - type: directory
          value: app/Modules/Communication/Domain/.*

    - name: MediaDomain
      collectors:
        - type: directory
          value: app/Modules/Media/Domain/.*

    # Module Application Layers
    - name: IdentityApplication
      collectors:
        - type: directory
          value: app/Modules/Identity/Application/.*

    - name: TenantApplication
      collectors:
        - type: directory
          value: app/Modules/Tenant/Application/.*

    - name: CatalogApplication
      collectors:
        - type: directory
          value: app/Modules/Catalog/Application/.*

    - name: VehicleApplication
      collectors:
        - type: directory
          value: app/Modules/Vehicle/Application/.*

    - name: PartnerApplication
      collectors:
        - type: directory
          value: app/Modules/Partner/Application/.*

    - name: WorkshopApplication
      collectors:
        - type: directory
          value: app/Modules/Workshop/Application/.*

    - name: SalesApplication
      collectors:
        - type: directory
          value: app/Modules/Sales/Application/.*

    - name: InventoryApplication
      collectors:
        - type: directory
          value: app/Modules/Inventory/Application/.*

    - name: TreasuryApplication
      collectors:
        - type: directory
          value: app/Modules/Treasury/Application/.*

    - name: AccountingApplication
      collectors:
        - type: directory
          value: app/Modules/Accounting/Application/.*

    - name: CommunicationApplication
      collectors:
        - type: directory
          value: app/Modules/Communication/Application/.*

    - name: MediaApplication
      collectors:
        - type: directory
          value: app/Modules/Media/Application/.*

    # Module Infrastructure Layers
    - name: IdentityInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Identity/Infrastructure/.*

    - name: TenantInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Tenant/Infrastructure/.*

    - name: CatalogInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Catalog/Infrastructure/.*

    - name: VehicleInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Vehicle/Infrastructure/.*

    - name: PartnerInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Partner/Infrastructure/.*

    - name: WorkshopInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Workshop/Infrastructure/.*

    - name: SalesInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Sales/Infrastructure/.*

    - name: InventoryInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Inventory/Infrastructure/.*

    - name: TreasuryInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Treasury/Infrastructure/.*

    - name: AccountingInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Accounting/Infrastructure/.*

    - name: CommunicationInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Communication/Infrastructure/.*

    - name: MediaInfrastructure
      collectors:
        - type: directory
          value: app/Modules/Media/Infrastructure/.*

    # Module Presentation Layers
    - name: Presentation
      collectors:
        - type: directory
          value: app/Modules/.*/Presentation/.*

  ruleset:
    # Shared layers are accessible by all
    SharedDomain: ~
    SharedContracts: ~
    SharedApplication:
      - SharedDomain
      - SharedContracts
    SharedInfrastructure:
      - SharedDomain
      - SharedContracts
      - SharedApplication

    # Domain layers can ONLY depend on SharedDomain and SharedContracts
    # NO cross-module domain dependencies!
    IdentityDomain:
      - SharedDomain
      - SharedContracts
    TenantDomain:
      - SharedDomain
      - SharedContracts
    CatalogDomain:
      - SharedDomain
      - SharedContracts
    VehicleDomain:
      - SharedDomain
      - SharedContracts
    PartnerDomain:
      - SharedDomain
      - SharedContracts
    WorkshopDomain:
      - SharedDomain
      - SharedContracts
    SalesDomain:
      - SharedDomain
      - SharedContracts
    InventoryDomain:
      - SharedDomain
      - SharedContracts
    TreasuryDomain:
      - SharedDomain
      - SharedContracts
    AccountingDomain:
      - SharedDomain
      - SharedContracts
    CommunicationDomain:
      - SharedDomain
      - SharedContracts
    MediaDomain:
      - SharedDomain
      - SharedContracts

    # Application layers can depend on their domain and shared layers
    # Cross-module communication via SharedContracts ONLY
    IdentityApplication:
      - IdentityDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    TenantApplication:
      - TenantDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    CatalogApplication:
      - CatalogDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    VehicleApplication:
      - VehicleDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    PartnerApplication:
      - PartnerDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    WorkshopApplication:
      - WorkshopDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    SalesApplication:
      - SalesDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    InventoryApplication:
      - InventoryDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    TreasuryApplication:
      - TreasuryDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    AccountingApplication:
      - AccountingDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    CommunicationApplication:
      - CommunicationDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication
    MediaApplication:
      - MediaDomain
      - SharedDomain
      - SharedContracts
      - SharedApplication

    # Infrastructure layers can depend on everything in their module + shared
    IdentityInfrastructure:
      - IdentityDomain
      - IdentityApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    TenantInfrastructure:
      - TenantDomain
      - TenantApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    CatalogInfrastructure:
      - CatalogDomain
      - CatalogApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    VehicleInfrastructure:
      - VehicleDomain
      - VehicleApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    PartnerInfrastructure:
      - PartnerDomain
      - PartnerApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    WorkshopInfrastructure:
      - WorkshopDomain
      - WorkshopApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    SalesInfrastructure:
      - SalesDomain
      - SalesApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    InventoryInfrastructure:
      - InventoryDomain
      - InventoryApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    TreasuryInfrastructure:
      - TreasuryDomain
      - TreasuryApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    AccountingInfrastructure:
      - AccountingDomain
      - AccountingApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    CommunicationInfrastructure:
      - CommunicationDomain
      - CommunicationApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure
    MediaInfrastructure:
      - MediaDomain
      - MediaApplication
      - SharedDomain
      - SharedContracts
      - SharedApplication
      - SharedInfrastructure

    # Presentation can depend on application and domain of its module
    Presentation: ~

  formatters:
    graphviz:
      hidden_layers:
        - SharedDomain
        - SharedContracts
      groups:
        Shared:
          - SharedDomain
          - SharedContracts
          - SharedApplication
          - SharedInfrastructure
        Identity:
          - IdentityDomain
          - IdentityApplication
          - IdentityInfrastructure
        Tenant:
          - TenantDomain
          - TenantApplication
          - TenantInfrastructure
        Catalog:
          - CatalogDomain
          - CatalogApplication
          - CatalogInfrastructure
        Vehicle:
          - VehicleDomain
          - VehicleApplication
          - VehicleInfrastructure
        Partner:
          - PartnerDomain
          - PartnerApplication
          - PartnerInfrastructure
        Workshop:
          - WorkshopDomain
          - WorkshopApplication
          - WorkshopInfrastructure
        Sales:
          - SalesDomain
          - SalesApplication
          - SalesInfrastructure
        Inventory:
          - InventoryDomain
          - InventoryApplication
          - InventoryInfrastructure
        Treasury:
          - TreasuryDomain
          - TreasuryApplication
          - TreasuryInfrastructure
        Accounting:
          - AccountingDomain
          - AccountingApplication
          - AccountingInfrastructure
        Communication:
          - CommunicationDomain
          - CommunicationApplication
          - CommunicationInfrastructure
        Media:
          - MediaDomain
          - MediaApplication
          - MediaInfrastructure
